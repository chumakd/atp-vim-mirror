<head>
    <link rel="stylesheet" href="../doc_style.css"> 
    <link rel="shortcut icon" type="image/x-icon" href="../vim_shortcut.ico">
</head>
<a name="atp-bibsearch"></a>
<h2>SEARCHING IN BIB FILES</h2>
<div>
    <p class="alignleft"><a href="bibtex_atp.html">Previous:</a> Bibtex filetype plugin</p>
    <p class="aligncenter"><a href="index.html">Table of Contents</a></p>
    <p class="alignright"><a href="atp-completion.html">Next:</a> Completion</p>
</div>
<div style="clear: both;"></div>

	<div class=indented><h4>Table of Contents:</h4></div>
	<div class=indented><a href="#atp-:BibSearch">atp-:BibSearch</a></div>
	<div class=indented><a href="#atp-bibpatterns">atp-bibpatterns</a></div>
	<div class=indented><a href="#atp-bibflags">atp-bibflags</a></div>
	    <div class=double_indent><a href="#atp-bibflags:default">atp-bibflags:default</a></div>
	    <div class=double_indent><a href="#atp-bibsearch-show-only-keys">atp-bibsearch-show-only-keys</a></div>
	    <div class=double_indent><a href="#atp-bibflags:+">atp-bibflags:+</a></div>
	    <div class=double_indent><a href="#atp-bibflags:output">atp-bibflags:output</a></div>
	    <div class=double_indent><a href="#atp-bibflags:last">atp-bibflags:last</a></div>
	    <div class=double_indent><a href="#atp-bibflags:add-flag">atp-bibflags:add-flag</a></div>	
	    <div class=doublf_indent><a href="#atp-bibflags:examples">atp-bibflags:examples</a></div>
	<div class=indented><a href="#atp-:BibChoose">atp-:BibChoose</a></div>	
	<div class=indented><a href="#atp-bibsearch-highlight">atp-bibsearch-highlight</a></div>

	    <h4>Naming Conventions:</h4>
	    <pre>
		@article{&ltlabel&gt,					\	
			author = { .... },		&lt-- bib entry   | 
			title  = { .... },				 &gt bib field
			journal= " .... ",				|
		}							/	

			article 		&lt-- bib field keyword 
			author,title,...	&lt-- bib entry label 	
			&ltlabel&gt			&lt-- bib field label 	
	    </pre>


<p>One more function is provided which searches the bib files for bib fields, 
and for the bib field labels for the latex command \cite{}.</p>

    <a name="atp-:BibSearch"></a> 	
<div class=command>:BibSearch /{pattern}/ [flag]</div>
	<p>which do what you expect. The arguments should not be quoted and
	separated by a white spaces (if you want to include a white space use
	'\ '), for more see |f-args|. If you do not provide any argument then
	all entries of all bib files will be shown. </p>
	
	<a name="g:atp_bibsearch"></a>
	<p>Note: {pattern} should be python regular expression not vim regular
	exression. Unless you set |g:atp_bibsearch|="vim" (the default is
	"python"). Python regular expressions are quite similar to vim with
	'nomagic' set ( grouping with '(' and ')', with separating
	alternatives with '|'). But there is no vim '\&' in python regexp.</p>

	<p>The pattern to highlight matching string is passed to |@/| hence you can
	use |n| and |N| in the BibSearch buffer. This will only work for
	{pattern} which is both vim and python regular expression.</p>

	<p>See <a href="#atp-bibflags">atp-bibflags</a> for the [flag] argument.</p>

	<p>The next one shows all bib fields which were written by Joyal and
	Tirney (and may by somebody else).</p>

	    <div class=command>:BibSearch author.*Joyal\&.*Tirney</div>
 	<div class=indented>This is not possible with |g:atp_bibsearch|="python" (the default).</div>

	<a name="atp-bibpatterns"></a>
	<p>Note: Upper pattern is vim pattern lower one is python regexp.</p> 

	<p>Before the match all the ligature symbols and {:} are removed. For
	example \`a, \' e, \oa,\ea are substituted with a, e, oa, ea
	(respectively).  Note that the space in \' e is also removed. Each
	line (without ligatures) of every bib file found in your tex document
	will be matched against the pattern, for example if the pattern is:</p>
	<div class=example>	
	    'author.*Grothendieck'<br>
	    'author.*Grothendieck'</div>
	the BibSearch function will find all the bibliographic fields
	which in one line have the words 'author' and 'Grothendieck' (in most
	cases it means that you will see only works of Grothendieck). Another
	example:
	<div class=example>	
	    '^\(\s*author.*Joayl\)\|Galois Theory'<br>
	    '^(\s*author.*Joayl)|Galois Theory'</div>
	will result in all bib fields which author is Joyal or 
	which includes the words 'Galois Theory' (which by the way appear in
	many article/book titles), yet another example:	
	<div class=example>	
	    'author.*Joayl\|title.*Galois Theory'<br>
	    'author.*Joayl|title.*Galois Theory'</div>
	This will match against all bib entries written by Joyal or which title
	includes the word 'Galois Theory'.
	<div class=example>	
	    'author.*Joyal\&.*Tirney'<br>
	    ! python has no '\&' !</div>
	will find all the bib entries which were written by Joyal and Tirney
	(and maybe somebody else). </p>

	<p>For now, there is no possibility to filter bibliographic entries which
	both match a pattern in separate lines, i.g. to show all bib entries
	written by Joyal on 'Descent Theory'.</p>

	<p>Before a match, all '{', and '}' are deleted from the line of the bib file.
	But you will see them in the output (what can be useful for debugging
	errors in bib files)</p>

	<p>Note that in Vim patterns should be quoted using '...' not "...".  </p> 

	<p>Further examples are supplied after the next section
	<a href="#atp-bibflags:examples">atp-bibflags:examples</a>, which describes other functionalities of the
	BibSearch/BibChoose commands.</p>

	<div align=right><a name="atp-bibpattern:last">b:atp-bibpattern:last</a></div>
	<div align=right><a name="atp-bib-b:atp_LastBibPattern">atp-bib-b:atp_LastBibPattern"</a></div>
	<p>The variable 'b:atp_LastBibPattern' stores the last pattern used by
	bib search.</p>

	<a name="atp-bibflags"></a>
	<p>The first optional argument [flags] chooses what and in which order
	you want to see the  bib entries found (entries are listed in
	the order they appear in bib file).  Flag is a word made of letters.
	There are three kinds of flags: entry flags which matches against
	labels of bib entries, like author, title, etc..., and keyword flags: which
	matches against keywords of bib fields: @article, @book, @techreport,
	etc...  and two special flags 'All' and 'L'. A flag is a word on
	letters:</p>
<pre>
		a  - author
 		e  - editor
 		t  - title
 		b  - booktitle
 		j  - journal
 		s  - series
 		y  - year
 		n  - number
 		v  - volume
 		p  - pages
 		P  - Publisher
 		N  - Note
 		S  - School
 		h  - howpublished
 		o  - organization
		u  - url	
		H  - Homepage	
  any other letter - do not show anything but the first line of bib entry 
		@a - article 						/@article/
		@b - book or booklet 					/@book,@booklet/
		@B - Booklet 						/@booklet/	
		@c - incollection 					/@incollection,@inbook/
		@p - proceedings, inproceedings, conference   		/@proceedings,@inproceedings,@conference/
		@m - misc 						/@misc/
		@M - Manual 						/@manual/
		@t - master or PhD thesis  				/@masterthesis,@phdthesis/
		@T - Techreport 					/@techreport/
		@u - unpublished  					/@unpublished/		
		All - all flags						(see <a href="#atp-bibflags:all">atp-bibflags:all)</a>		
		L   - last flags					(see <a href="#atp-bibflags:last">atp-bibflags:last)</a>		
</pre>
	<p>Examples:
	<div class=example>
	    tayu@a		--&gt show the entries: tile, author, year, url of matching articles.</div>
	<div class=example>
		baeP@b		--&gt show the entries: booktitle, author, editor, 
		publisher of matching books (@book,@booklet).</div>

	<p>Flags '@.' are filtered out, if one does not belong to the one above
	then it is deleted. You can see which flags are defined using
	ShowOptions function/command (they are listed as Available
	KeyWordFlags).</p>
	<a name="atp-bibflags:default"></a>
	<p>The default flag is stored in the global variable g:defaultbibflags and is
	equal to 'tabejsyu'. This means that the output for each bib field found 
	will include the <pre>
		title
		author
		booktitle
		editor
		journal 
		series
		year
	    </pre>
	if title,author,... are specified in the bibliography for the given
	position. If there are many position which match you can set flags to
	be as simple as possible to include more lines on the screen. For
	example 'tabe' is quite reasonable (note that all bib entries are
	matched separately, i.e. if a bib field has both 'title' and 'booktitle'
	bib entries it will give you both of them.</p>

	<a name="atp-bibsearch-show-only-keys"></a>
	<p>If you just want to list just the lines with bib fields keywords:
	@article{, @book{, etc. supply a flag which do not belongs to
	'g:defaultallbibflags', for example 'X', or 'X@a'</p>
	
	<a name="atp-bibflags:+"></a>
	<p>You can also specify flags with '+', for example: 
	<div class=example>flags='+p'</div>
	<div class=example>flags='+@b'</div>
	This feature <b>adds flags to the default value</b> defined in the variable
	g:defaultbibflags (see <a
	    href="#atp-defaulbibflags">atp-defaulbibflags)</a>. The first will
	result in showing the default entries and the page number, the second
	will result in showing only books with the default bib entries. You can
	specify as many additional flags as you wish.  <a name="atp-bibflags:output"></a>
	Note that the function shows the line with database file name if there
	are entries in this bibliography which match the pattern thus,for
	example, if you specify the flag '@a' and you see the line with
	database file name, but you do not see any bib entry, then in this
	database there are bib fields which match but these are not
	articles.</p>
	
	<a name="atp-bibflags:all"></a>
	<p>The flags='All' is a synonym of flag=g:defaultallbibflags which by default is
	equal to'tabejfsvnyPNSohiuHcp' i.e. all flags in this order. If you
	add your own flag you should change this global variable. You can add to
	this flag any flag which contains '@' (see <a href="#atp-bibflags">atp-bibflags)</a> by
	the plus operator, i.e. All+@a@b or +@aAll will give the same result.</p>

	<a name="atp-bibflags:last"></a> <a name="atp-bib-b:atp_LastBibFlags"></a>	
	<p>The variable 'b:atp_LastBibFlags' stores the recently used flags. The flag
	'L' sets the flags for this search to the value of 'b:atp_LastBibFlags'.
	You can write '+L@a', '+L@a', 'L@a' or '@aL' but not '+@La', if you
	want to add some flags to previous searches. Next time the flag 'L'
	will change the meaning (i.e. it is really the last time not earlier
	:) However, there is no '-' :( '-@aL' could be helpful.</p>
	 
	<p>The variable 'b:atp_LastBibFlags' is not changed when you use the 'All'
	flag.</p>

	<a name="atp-bibflags:add-flag"></a>
	<p>You can add your own flags but not keyword flags (i.e. @a,@b,...).
	Just add an entry to the dictionary g:bibflagsdict. (:ShowOptions v to
	see its current value), For example
	<div class=variable>let g:bibflagsdict=extend(g:bibflagsdict,  { '<flags_name>' : [ '<bib_entry_name>': '<how_to_show>'] })</div>
	where, &ltflags_name&gt is the flag to use (it should be one letter), it
	must be different from the defined flags, &ltbib_entry_name&gt is a
	lower case bib entry name, like 'title', 'url', etc., &lthow_to_show&gt if
	you want to have a nice output put the bib entry name and that much of
	white spaces to get 13 strings.</p>

	<a name="atp-bibflags:examples"></a>
	<p>Some examples:						
	    <div class=command>:BibSearch</div> 
				<div class=indented>Above command shows all bib fields with
				the default flags (might be slow, why not to
				open bib file with :GotoFile)</div>
	    <div class=command>:BibSearch @ yt</div>	
				<div class=indented>and this is a tip how to show all bib fields with
				different flags than the default ones(the '@'
				will match at every bib field!). It is
				equivalent to:</div>
	    <div class=command>:BibSearch // yt</div>

	    <div class=command>:BibSearch /title[\s.]*Galois Theory/  aetb</div>

<a name="atp-:BibChoose"></a>
<div class=command>:BibChoose {BibEntry[RegisterName]}</div>
<div class=map>map c, map y, map p</div>
	<p>This command is only available in the window with BibSearch results
	and allows to copy a bib entry key to a register or directly to the
	last opened buffer (after the cursor position). It is mapped to 'c'
	and 'y'. You will be asked to give the number of bib entry to yank:</p>
<pre>
	    &ltbib entry number&gt&ltregister name&gt&ltEnter&gt	- to copy it to a register
	    &ltbib entry number&gt&ltEnter&gt			- to paste it to 'tex' file
	    &ltEnter&gt					- to skip the choice
</pre>	
	When you paste the bib entry key the bib search window will close. For
	example:
		<div class=command>:BibChoose 5e</div>
		<div class=command>:BibChoose 7+</div>
		<div class=command>:BibChoose 2</div>
	Copy the bibkey to register e,+ or paste directly to the buffer 
	in which :BibSearch was invoked, at last cursor position.</p>

	<p>The same you will obtain using the nmaps y or c.</p> 
	
	<p>This commands and maps are only in the BibSearch buffer.</p>

	<a name="atp-bibsearch-highlight"></a>
	<p>The colours of the output are set by the syntax file
	'syntax/bibsearch_atp.Vim'. All groups except one are the same as in
	the syntax file for bib files ('syntax/bib.Vim' in your $VIMRUNTIME
	directory). Their names are 'bibsearchEntryKw' instead 'bibEntryKw'.
	The one that is differently defined 'bibsearchComment'.  Which is
	changed in that way to highlight the bib file names.  One additional
	highlight group is: 'bibsearchInfo'. It highlights the number of
	entry and its line number in the bib file. By default all bibsearch
	groups are linked to the corresponding bib group, the bibsearchInfo
	group is not set.</p>
	
	<p>In a colour file (~/.Vim/color/*.Vim) you can use these groups to set
	colours.  See |highlight| or just read a colour file. For example,
	this is a nice set of colours for dark background </p>
		
<a name="atp-bibsearch-notes"></a>
<h3>Notes</h3>
    <a name="atp-bibsearch-comments"></a>
	<p>Please do not hesitate to report any bug to the 
	<a
	    href="http://sourceforge.net/mailarchive/forum.php?forum_name=atp-vim-list">mailing
	    list</a>.</p>
	
	<p>The algorithm will work only if all kind of bib entries of your bib
	file are included in the list g:bibentries. However, changing just this
	variable is not enough. In that case the search engine (function
	s:search) will produce correct output, but the function which displays
	found entries, will not know how to work with the new entries. One
	would have to add an entry to the dictionary 'g:bibflagsdict'. If it is
	the case, please let me know on the <a
	    href="http://sourceforge.net/mailarchive/forum.php?forum_name=atp-vim-list">mailing
	    list</a>.</p> 

	<p>As you can see entries of the type '@string' which can be used in
	bib files are not supported (i.e. there is no function which
	substitutes the variables defined in @string to their values), but it
	is doable.  @string{ Name = Value }</p>
